<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#01161E" />
    <title>Timer Review</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Karla:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: '#01161E',
              background: '#124559',
              primary: '#598392',
              secondary: '#AEC3B0',
              light: '#EFF6E0',
              accent: '#83c5be',
              rest: '#94d1be',
              interval: '#e76f51',
              warning: '#fc814a',
            },
            fontFamily: {
              karla: ['Karla', 'sans-serif'],
            },
          },
        },
      };
    </script>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        padding-top: env(safe-area-inset-top);
        background-color: #01161E;
        font-family: 'Karla', sans-serif;
        overscroll-behavior: none;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 50;
        padding: 1rem;
        background-color: #01161E;
        transition: background-color 0.3s ease, backdrop-filter 0.3s ease;
      }

      header::before {
        content: "";
        position: absolute;
        top: -100vh;
        left: 0;
        right: 0;
        height: 100vh;
        background-color: #01161E;
        z-index: -1;
      }

      header.scrolled {
        background-color: rgba(1, 22, 30, 0.7);
        backdrop-filter: blur(6px);
      }

      .interval-item {
        background-color: #124559;
        border: 1px solid rgba(239, 246, 224, 0.1);
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .interval-item.is-rest-type {
        background-color: #598392; /* primary Farbe für Rest-Elemente in Review */
      }
    </style>
  </head>

  <body class="bg-dark text-light font-karla flex flex-col min-h-screen">
    <header id="header" class="text-light shadow-md">
      <div class="w-full flex justify-between items-center">
        <button id="backButton" class="text-accent font-semibold hover:underline">Back</button>
        <h1 id="timerReviewTitle" class="text-xl font-bold text-accent tracking-wide"></h1>
        <button id="editButton" class="text-accent font-semibold hover:underline">Edit</button>
      </div>
    </header>

    <main class="flex-grow p-4 overflow-y-auto">
      <section class="mb-6 bg-background rounded-xl p-4 shadow-lg">
        <h2 class="text-accent font-semibold text-lg mb-2">Details</h2>
        <div class="flex justify-between mb-2">
          <span class="text-light">Total Duration:</span>
          <span id="totalDuration" class="text-accent font-semibold"></span>
        </div>
        <div class="flex justify-between">
          <span class="text-light">Repeats:</span>
          <span id="repeatCount" class="text-accent font-semibold"></span>
        </div>
      </section>

      <section class="mb-6">
        <h2 class="text-accent font-semibold text-lg mb-3">Intervals</h2>
        <div id="intervalsContainer" class="space-y-3">
          </div>
      </section>
    </main>

    <footer class="p-4 bg-background shadow-lg sticky bottom-0 w-full">
      <button
        id="startButton"
        class="w-full bg-accent text-dark py-3 rounded-xl font-bold hover:bg-accent/90 transition-colors"
      >
        Start Timer
      </button>
    </footer>

    <script>
      const header = document.getElementById('header');
      const backButton = document.getElementById('backButton');
      const editButton = document.getElementById('editButton');
      const startButton = document.getElementById('startButton');
      const timerReviewTitle = document.getElementById('timerReviewTitle');
      const totalDurationSpan = document.getElementById('totalDuration');
      const repeatCountSpan = document.getElementById('repeatCount');
      const intervalsContainer = document.getElementById('intervalsContainer');

      let currentTimer = null; // Speichert den aktuell angezeigten Timer

      // --- Hilfsfunktionen ---

      // Formatiert die Dauer für die Anzeige (Min, Sek)
      function formatDurationForDisplay(durationString) {
          const parts = durationString.split(':');
          const minutes = parseInt(parts[0], 10);
          const seconds = parseInt(parts[1], 10);
          let formatted = [];
          if (minutes > 0) {
              formatted.push(`${minutes} Min`);
          }
          if (seconds > 0 || (minutes === 0 && seconds === 0)) { // "0 Sek" anzeigen, wenn alles 0 ist
              formatted.push(`${seconds} Sek`);
          }
          return formatted.join(' ') || "0 Sek"; // Fallback für leere Zeiten
      }

      // Berechnet die Gesamtdauer eines Timers in Sekunden und formatiert sie
      function calculateTotalDuration(timer) {
          if (!timer || !timer.intervals || timer.intervals.length === 0) {
              return "0 Sek";
          }

          let totalSeconds = 0;
          timer.intervals.forEach(interval => {
              const parts = interval.duration.split(':');
              totalSeconds += parseInt(parts[0], 10) * 60;
              totalSeconds += parseInt(parts[1], 10);
          });

          // Multipliziere mit der Wiederholungsanzahl
          totalSeconds *= timer.repeat;

          const minutes = Math.floor(totalSeconds / 60);
          const seconds = totalSeconds % 60;

          let formatted = [];
          if (minutes > 0) {
              formatted.push(`${minutes} Min`);
          }
          if (seconds > 0 || minutes === 0) {
              formatted.push(`${seconds} Sek`);
          }
          return formatted.join(' ');
      }

      // Rendert die Timer-Details
      function renderTimerDetails(timer) {
        if (!timer) {
          console.error('Kein Timer zum Anzeigen gefunden.');
          // Optional: Fehlermeldung anzeigen oder zurück zur Home-Seite navigieren
          intervalsContainer.innerHTML = '<p class="text-light/70 text-center">Fehler: Timer konnte nicht geladen werden.</p>';
          return;
        }

        timerReviewTitle.textContent = timer.name;
        totalDurationSpan.textContent = calculateTotalDuration(timer);
        repeatCountSpan.textContent = timer.repeat;

        intervalsContainer.innerHTML = ''; // Vorherige Intervalle entfernen

        timer.intervals.forEach(interval => {
          const intervalItem = document.createElement('div');
          intervalItem.classList.add('interval-item', 'shadow-md'); // Shadow hinzugefügt

          if (interval.type === 'rest') {
            intervalItem.classList.add('is-rest-type');
          }

          intervalItem.innerHTML = `
            <span class="text-light">${interval.name}</span>
            <span class="text-accent font-semibold">${formatDurationForDisplay(interval.duration)}</span>
          `;
          intervalsContainer.appendChild(intervalItem);
        });
      }

      // --- Event Listener ---

      backButton.addEventListener('click', () => {
        window.location.href = '../index.html'; // Zurück zum Home-Screen
      });

      editButton.addEventListener('click', () => {
        if (currentTimer) {
          // Speichere den aktuellen Timer im localStorage für den Editor
          localStorage.setItem('timerToEdit', JSON.stringify(currentTimer));
          window.location.href = '../../timer-editor/timer-editor.html'; // Zum Timer-Editor
        }
      });

      startButton.addEventListener('click', () => {
        if (currentTimer) {
          // Speichere den aktuellen Timer im localStorage für den Timer-Screen
          localStorage.setItem('currentRunningTimer', JSON.stringify(currentTimer));
          window.location.href = '../../timer-screen/timer-screen.html'; // Zum Timer-Screen
        } else {
          alert('Kein Timer zum Starten ausgewählt!');
        }
      });

      window.addEventListener('scroll', () => {
        if (window.scrollY > 0) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });

      // --- Initialisierung beim Laden der Seite ---
      document.addEventListener('DOMContentLoaded', () => {
        const storedTimer = localStorage.getItem('currentTimerForReview');
        if (storedTimer) {
          currentTimer = JSON.parse(storedTimer);
          renderTimerDetails(currentTimer);
          // Lösche den Eintrag, nachdem er gelesen wurde, da er nur für diese Ansicht gedacht ist
          localStorage.removeItem('currentTimerForReview');
        } else {
          console.warn('Kein Timer im localStorage für Review gefunden. Zurück zum Home-Screen.');
          // Optional: Direkt zurück zum Home-Screen, wenn keine Daten vorhanden sind
          // window.location.href = '../index.html';
        }
      });
    </script>
  </body>
</html>