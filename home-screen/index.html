<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#01161E" />
    <title>Home Screen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Karla:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              dark: '#01161E',
              background: '#124559',
              primary: '#598392',
              secondary: '#AEC3B0',
              light: '#EFF6E0',
              accent: '#83c5be',
              rest: '#94d1be',
              interval: '#e76f51',
              warning: '#fc814a',
            },
            fontFamily: {
              karla: ['Karla', 'sans-serif'],
            },
          },
        },
      };
    </script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: #01161E;
        font-family: 'Karla', sans-serif;
        overscroll-behavior: none;
        scroll-padding-top: 4rem;
        scroll-behavior: smooth;
        color: #EFF6E0;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 50;
        padding: 1rem;
        background-color: #01161E;
      }

      .timer-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        scroll-behavior: smooth;
      }

      .timer-item {
        background-color: #124559;
        border-bottom: 1px solid #EFF6E0;
        display: flex;
        align-items: center;
        padding: 1rem;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .timer-name {
        font-size: 1.2rem;
        color: #edede9;
        margin-left: 0.5rem;
        flex-grow: 1;
      }

      .timer-duration {
        font-size: 1rem;
        color: #83c5be;
      }

      .sortable-chosen {
        background-color: #AEC3B0 !important;
      }
    </style>
  </head>
  <body class="text-light">
    <header id="header" class="text-light shadow-md">
      <div class="w-full flex justify-between items-center">
        <button id="optionsButton" class="header-button">
          Options
        </button>
        <h1 class="text-xl font-bold text-accent tracking-wide">Timer</h1>
        <button
          id="addButton"
          class="header-button text-2xl leading-none hover:scale-110 transition-transform duration-150"
        >
          +
        </button>
      </div>
    </header>
    <ul class="timer-list" id="timerList"></ul>

    <script>
      const timerList = document.getElementById('timerList');
      const addButton = document.getElementById('addButton');
      const optionsButton = document.getElementById('optionsButton');

      // --- Dynamische Daten Integration ---

      /**
       * Lädt alle gespeicherten Timer aus dem localStorage.
       */
      function loadTimersFromStorage() {
        const storedTimers = localStorage.getItem('timers');
        return storedTimers ? JSON.parse(storedTimers) : [];
      }

      /**
       * Lädt die vollständige Dauer eines Timers, indem alle Intervalle summiert werden.
       * @param {Timer} timer Der Timer, dessen Gesamtzeit berechnet wird.
       * @returns {number} Die Gesamtdauer in Sekunden.
       */
      function calculateTotalDuration(timer) {
        let totalDuration = 0;
        timer.intervals.forEach(interval => {
          totalDuration += interval.duration * (timer.repeat || 1);
        });
        return totalDuration;
      }

      /**
       * Konvertiert Sekunden in ein anzeigbares Zeitformat "MM:SS".
       * @param {number} totalSeconds Die Anzahl der Sekunden.
       * @returns {string} Formattierte Zeit im Format "MM:SS".
       */
      function formatDuration(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }

      /**
       * Erstellt ein Timer-Element für die Anzeige in der Liste.
       * @param {Timer} timer Ein Timer-Objekt.
       */
      function createTimerItem(timer) {
        const li = document.createElement('li');
        li.classList.add('timer-item');
        li.setAttribute('data-id', timer.id);

        const nameSpan = document.createElement('span');
        nameSpan.classList.add('timer-name');
        nameSpan.textContent = timer.name;

        const durationSpan = document.createElement('span');
        durationSpan.classList.add('timer-duration');
        const totalDuration = calculateTotalDuration(timer);
        durationSpan.textContent = formatDuration(totalDuration);

        li.appendChild(nameSpan);
        li.appendChild(durationSpan);

        // Timer auswählen und zur Timer-Screen navigieren
        li.addEventListener('click', () => {
          localStorage.setItem('selectedTimerId', timer.id);
          window.location.href = '../timer-screen/timer-screen.html';
        });

        timerList.appendChild(li);
      }

      /**
       * Lädt die Timer-Zustände und rendert die Timer-Liste dynamisch.
       */
      function renderTimerList() {
        timerList.innerHTML = ''; // Liste löschen
        const timers = loadTimersFromStorage(); // Timer laden

        if (timers.length === 0) {
          const noTimersMessage = document.createElement('li');
          noTimersMessage.classList.add('text-center', 'text-secondary', 'mt-8', 'text-lg', 'p-4');
          noTimersMessage.textContent = 'No timers yet. Tap "+" to create one!';
          timerList.appendChild(noTimersMessage);
          return;
        }

        timers.forEach(timer => {
          createTimerItem(timer);
        });
      }

      // Add Timer Button
      addButton.addEventListener('click', () => {
        localStorage.removeItem('selectedTimerId'); // Kein spezifischer Timer gewählt
        window.location.href = '../timer-editor/timer-editor.html';
      });

      // Options Button
      optionsButton.addEventListener('click', () => {
        window.location.href = '../options-screen/options-screen.html';
      });

      // Initiales Laden der Timer
      document.addEventListener('DOMContentLoaded', () => {
        renderTimerList();
      });
    </script>
  </body>
</html>