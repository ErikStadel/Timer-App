<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#01161E" />
  <title>Interval Editor</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="../js/dataStorage.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: '#01161E',
            background: '#124559',
            primary: '#598392',
            secondary: '#AEC3B0',
            light: '#EFF6E0',
            accent: '#83c5be',
            rest: '#94d1be',
            interval: '#e76f51',
            warning: '#fc814a',
          },
          fontFamily: {
            karla: ['Karla', 'sans-serif'],
          },
        },
      },
    };
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: #01161E;
      font-family: 'Karla', sans-serif;
      color: #EFF6E0;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      padding: 1rem;
      background-color: #01161E;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 2rem;
      background-color: #124559;
      border-radius: 1rem;
    }

    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;utf8,<svg fill='%23EFF6E0' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
      background-repeat: no-repeat;
      background-position-x: calc(100% - 10px);
      background-position-y: center;
      padding-right: 2rem;
    }

    select::-ms-expand {
      display: none;
    }

    .tab {
      overflow: hidden;
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .tab button {
      flex: 1;
      background-color: #598392;
      color: #EFF6E0;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 0.75rem;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .tab button:hover {
      background-color: #AEC3B0;
    }

    .tab button.active {
      background-color: #AEC3B0;
      color: #01161E;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>

<body class="text-light">
  <header class="text-light shadow-md w-full fixed top-0 left-0">
    <div class="w-full flex justify-between items-center p-4 bg-dark">
      <button class="text-accent font-semibold hover:underline" onclick="window.location.href = '../timer-editor/timer-editor.html?timerId=' + new URLSearchParams(window.location.search).get('timerId')">Back</button>
      <h1 class="text-xl font-bold text-accent tracking-wide">Interval Editor</h1>
      <button id="saveButton" class="text-accent font-semibold hover:underline">Save</button>
    </div>
  </header>

  <div class="container mt-16">
    <div class="mb-6">
      <label for="intervalNameInput" class="block text-accent font-semibold mb-1">Interval Name</label>
      <input
        type="text"
        id="intervalNameInput"
        placeholder="z.B. Arbeit"
        class="w-full px-4 py-2 rounded-xl bg-light text-dark placeholder:text-dark/50 focus:outline-none focus:ring-2 focus:ring-accent"
      />
    </div>

    <div class="mb-6">
      <label for="signalSelect" class="block text-accent font-semibold mb-1">Signal</label>
      <select id="signalSelect" class="w-full px-4 py-2 rounded-xl bg-light text-dark focus:outline-none focus:ring-2 focus:ring-accent">
        <!-- Signals will be populated dynamically -->
      </select>
    </div>

    <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'content-interval')">Interval</button>
      <button class="tablinks" onclick="openTab(event, 'content-rest')">Rest</button>
    </div>

    <div id="content-interval" class="tab-content active">
      <div class="flex gap-4">
        <div class="flex-1">
          <label for="intervalMinutes" class="block text-accent mb-1">Min</label>
          <select id="intervalMinutes" class="w-full px-4 py-2 rounded-xl bg-light text-dark focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="0">00</option>
            <option value="1">01</option>
            <option value="2">02</option>
            <option value="3">03</option>
            <option value="4">04</option>
            <option value="5">05</option>
            <option value="6">06</option>
            <option value="7">07</option>
            <option value="8">08</option>
            <option value="9">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
          </select>
        </div>
        <div class="flex-1">
          <label for="intervalSeconds" class="block text-accent mb-1">Sek</label>
          <select id="intervalSeconds" class="w-full px-4 py-2 rounded-xl bg-light text-dark focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="0">00</option>
            <option value="5">05</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="30">30</option>
            <option value="35">35</option>
            <option value="40">40</option>
            <option value="45">45</option>
            <option value="50">50</option>
            <option value="55">55</option>
          </select>
        </div>
      </div>
    </div>

    <div id="content-rest" class="tab-content">
      <div class="flex gap-4">
        <div class="flex-1">
          <label for="restMinutes" class="block text-accent mb-1">Min</label>
          <select id="restMinutes" class="w-full px-4 py-2 rounded-xl bg-light text-dark focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="0">00</option>
            <option value="1">01</option>
            <option value="2">02</option>
            <option value="3">03</option>
            <option value="4">04</option>
            <option value="5">05</option>
            <option value="6">06</option>
            <option value="7">07</option>
            <option value="8">08</option>
            <option value="9">09</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
            <option value="17">17</option>
            <option value="18">18</option>
            <option value="19">19</option>
            <option value="20">20</option>
            <option value="21">21</option>
            <option value="22">22</option>
            <option value="23">23</option>
            <option value="24">24</option>
            <option value="25">25</option>
            <option value="26">26</option>
            <option value="27">27</option>
            <option value="28">28</option>
            <option value="29">29</option>
            <option value="30">30</option>
          </select>
        </div>
        <div class="flex-1">
          <label for="restSeconds" class="block text-accent mb-1">Sek</label>
          <select id="restSeconds" class="w-full px-4 py-2 rounded-xl bg-light text-dark focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="0">00</option>
            <option value="5">05</option>
            <option value="10">10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="25">25</option>
            <option value="30">30</option>
            <option value="35">35</option>
            <option value="40">40</option>
            <option value="45">45</option>
            <option value="50">50</option>
            <option value="55">55</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }
      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }

    const intervalNameInput = document.getElementById('intervalNameInput');
    const signalSelect = document.getElementById('signalSelect');
    const intervalMinutes = document.getElementById('intervalMinutes');
    const intervalSeconds = document.getElementById('intervalSeconds');
    const restMinutes = document.getElementById('restMinutes');
    const restSeconds = document.getElementById('restSeconds');
    const saveButton = document.getElementById('saveButton');

    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const timerId = urlParams.get('timerId');
      const intervalId = urlParams.get('intervalId');

      if (!timerId) {
        alert('Timer-ID fehlt. Bitte erneut versuchen.');
        window.location.href = '../timer-editor/timer-editor.html';
        return;
      }

      const timers = loadTimers();
      const timer = timers.find(t => t.id === timerId);

      if (!timer) {
        alert('Timer nicht gefunden. Bitte erneut versuchen.');
        window.location.href = '../timer-editor/timer-editor.html';
        return;
      }

      // Populate signals
      const signals = loadSignals();
      signalSelect.innerHTML = signals.map(signal => `<option value="${signal.id}">${signal.name}</option>`).join('');
      
      let interval = null;
      if (intervalId) {
        interval = timer.intervals.find(i => i.id === intervalId);
        if (!interval) {
          alert('Intervall nicht gefunden.');
          window.location.href = `../timer-editor/timer-editor.html?timerId=${timerId}`;
          return;
        }
        intervalNameInput.value = interval.name;
        signalSelect.value = interval.signalId || 'signal-gong';
        intervalMinutes.value = Math.floor(interval.durationInterval / 60);
        intervalSeconds.value = interval.durationInterval % 60;
        restMinutes.value = Math.floor(interval.durationRest / 60);
        restSeconds.value = interval.durationRest % 60;
      } else {
        intervalNameInput.value = '';
        signalSelect.value = 'signal-gong';
        intervalMinutes.value = 0;
        intervalSeconds.value = 0;
        restMinutes.value = 0;
        restSeconds.value = 0;
      }

      saveButton.addEventListener('click', () => {
        const name = intervalNameInput.value.trim();
        const signalId = signalSelect.value;
        const durationInterval = parseInt(intervalMinutes.value) * 60 + parseInt(intervalSeconds.value);
        const durationRest = parseInt(restMinutes.value) * 60 + parseInt(restSeconds.value);

        if (!name) {
          alert('Interval name cannot be empty.');
          return;
        }

        const updatedInterval = {
          id: intervalId || generateUniqueId(),
          name,
          durationInterval,
          durationRest,
          signalId
        };

        if (intervalId) {
          const index = timer.intervals.findIndex(i => i.id === intervalId);
          timer.intervals[index] = updatedInterval;
        } else {
          timer.intervals.push(updatedInterval);
        }

        saveTimers(timers);
        window.location.href = `../timer-editor/timer-editor.html?timerId=${timerId}`;
      });
    });
  </script>
</body>
</html>